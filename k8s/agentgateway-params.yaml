apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayParameters
metadata:
  name: agentgateway-config
  namespace: agentgateway-system
  labels:
    app: agentgateway
spec:
  # Basic logging configuration (only format and level supported in spec)
  logging:
    format: json
    level: info
  
  # Raw configuration for advanced features including logging fields with CEL
  # This section uses the upstream agentgateway configuration format
  rawConfig:
    # Logging configuration with CEL expressions
    config:
      logging:
        format: json
        level: info
        fields:
          add:
            # CEL string literals - note the single quotes wrapping double quotes
            service: '"agentgateway"'
            version: '"1.0.0"'
    
    # Binds, listeners, and routes
    binds:
    - port: 3000
      listeners:
      - name: main
        routes:
        # Health check route - must come first to match before catch-all
        - name: health
          matches:
          - path:
              exact: /health
          policies:
            directResponse:
              body: '{"status":"healthy","service":"agentgateway"}'
              status: 200
        # Main AI route - catch-all for other requests
        - name: main
          policies:
            cors:
              allowOrigins:
              - "*"
              allowHeaders:
              - "content-type"
              - "authorization"
              - "cache-control"
              - "mcp-protocol-version"
              exposeHeaders:
              - "Mcp-Session-Id"
          backends:
          - ai:
              name: default
              provider:
                openAI:
                  model: gpt-4o-mini
